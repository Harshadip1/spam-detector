<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - SecureMessage AI</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Profile Icon Styles */
        .profile-icon-link {
            display: flex !important;
            align-items: center;
            justify-content: center;
            padding: 0.5rem !important;
        }
        
        .profile-circle {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .profile-icon-link:hover .profile-circle {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .profile-circle i {
            font-size: 1rem;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>SecureMessage AI</span>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link active">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="learn.html" class="nav-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Learn</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="download.html" class="nav-link">
                        <i class="fas fa-download"></i>
                        <span>Download</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="premium.html" class="nav-link">
                        <i class="fas fa-crown"></i>
                        <span>Premium</span>
                    </a>
                </li>
                <!-- Login Button (shown when not authenticated) -->
                <li class="nav-item login-btn" id="login-nav-item">
                    <a href="login.html" class="nav-link" id="auth-link">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Login</span>
                    </a>
                </li>
                
                <!-- Profile Icon (shown when authenticated) -->
                <li class="nav-item user-menu" id="user-menu" style="display: none;">
                    <a href="profile.html" class="nav-link profile-icon-link">
                        <div class="profile-circle" id="profile-circle">
                            <i class="fas fa-user"></i>
                        </div>
                    </a>
                </li>
            </ul>
            <div class="hamburger" id="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Dashboard Hero -->
    <section class="dashboard-hero">
        <div class="container">
            <div class="dashboard-header">
                <div class="welcome-section">
                    <h1 id="welcome-message">Welcome back, User!</h1>
                    <div class="user-info-bar">
                        <span id="user-name-display">User</span>
                        <span class="separator">•</span>
                        <span id="member-since">Member since January 2024</span>
                        <span class="separator">•</span>
                        <span id="last-login">Last login: Today</span>
                    </div>
                </div>
                <h2>Security Analytics Dashboard</h2>
                <p>Real-time insights into spam detection and threat analysis</p>
                <div class="dashboard-controls">
                    <select id="time-range" class="dashboard-select">
                        <option value="24h">Last 24 Hours</option>
                        <option value="7d" selected>Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                        <option value="90d">Last 90 Days</option>
                    </select>
                    <button id="refresh-data" class="btn btn-outline">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Statistics Overview -->
    <section class="stats-overview">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-card total-scans">
                    <div class="stat-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-scans-count">0</h3>
                        <p>Total Messages Scanned</p>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12.5%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card spam-detected">
                    <div class="stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="spam-detected-count">0</h3>
                        <p>Spam Messages Detected</p>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i>
                            <span>-3.2%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card safe-messages">
                    <div class="stat-icon">
                        <i class="fas fa-shield-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="safe-messages-count">0</h3>
                        <p>Safe Messages</p>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8.7%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card accuracy-rate">
                    <div class="stat-icon">
                        <i class="fas fa-bullseye"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="accuracy-rate">99.7%</h3>
                        <p>Detection Accuracy</p>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i>
                            <span>+0.3%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="charts-section">
        <div class="container">
            <div class="charts-grid">
                <!-- Spam Detection Trends -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Spam Detection Trends</h3>
                        <div class="chart-controls">
                            <button class="chart-btn active" data-chart="line">Line</button>
                            <button class="chart-btn" data-chart="bar">Bar</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="spam-trends-chart"></canvas>
                    </div>
                </div>

                <!-- Classification Distribution -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Message Classification</h3>
                        <div class="legend">
                            <div class="legend-item">
                                <span class="legend-color safe"></span>
                                <span>Safe</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color suspicious"></span>
                                <span>Suspicious</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color spam"></span>
                                <span>Spam</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="classification-chart"></canvas>
                    </div>
                </div>

                <!-- Threat Types -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Threat Categories</h3>
                        <p>Most common spam types detected</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="threat-types-chart"></canvas>
                    </div>
                </div>

                <!-- Real-time Activity -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Real-time Activity</h3>
                        <div class="activity-status">
                            <div class="status-indicator active"></div>
                            <span>Live</span>
                        </div>
                    </div>
                    <div class="activity-feed" id="activity-feed">
                        <!-- Activity items will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Advanced Analytics -->
    <section class="advanced-analytics">
        <div class="container">
            <div class="section-header">
                <h2>Advanced Analytics</h2>
                <p>Deep insights into security patterns and trends</p>
            </div>

            <div class="analytics-grid">
                <!-- Confidence Score Distribution -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3>Confidence Score Distribution</h3>
                        <i class="fas fa-chart-area"></i>
                    </div>
                    <div class="confidence-bars">
                        <div class="confidence-bar">
                            <div class="bar-label">90-100%</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: 85%;" data-value="85"></div>
                            </div>
                            <div class="bar-value">85%</div>
                        </div>
                        <div class="confidence-bar">
                            <div class="bar-label">80-89%</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: 12%;" data-value="12"></div>
                            </div>
                            <div class="bar-value">12%</div>
                        </div>
                        <div class="confidence-bar">
                            <div class="bar-label">70-79%</div>
                            <div class="bar-container">
                                <div class="bar-fill" style="width: 3%;" data-value="3"></div>
                            </div>
                            <div class="bar-value">3%</div>
                        </div>
                    </div>
                </div>

                <!-- Top Risk Indicators -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3>Top Risk Indicators</h3>
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="risk-indicators">
                        <div class="risk-item">
                            <div class="risk-info">
                                <span class="risk-name">Financial Scams</span>
                                <span class="risk-count">1,247 detected</span>
                            </div>
                            <div class="risk-percentage">34%</div>
                        </div>
                        <div class="risk-item">
                            <div class="risk-info">
                                <span class="risk-name">Phishing Attempts</span>
                                <span class="risk-count">892 detected</span>
                            </div>
                            <div class="risk-percentage">24%</div>
                        </div>
                        <div class="risk-item">
                            <div class="risk-info">
                                <span class="risk-name">Malicious URLs</span>
                                <span class="risk-count">567 detected</span>
                            </div>
                            <div class="risk-percentage">15%</div>
                        </div>
                        <div class="risk-item">
                            <div class="risk-info">
                                <span class="risk-name">Promotional Spam</span>
                                <span class="risk-count">423 detected</span>
                            </div>
                            <div class="risk-percentage">12%</div>
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3>Performance Metrics</h3>
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <div class="performance-metrics">
                        <div class="metric">
                            <div class="metric-label">Average Response Time</div>
                            <div class="metric-value">127ms</div>
                            <div class="metric-change positive">-15ms</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">False Positive Rate</div>
                            <div class="metric-value">0.3%</div>
                            <div class="metric-change positive">-0.1%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Model Confidence</div>
                            <div class="metric-value">94.7%</div>
                            <div class="metric-change positive">+1.2%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-shield-alt"></i>
                        <span>SecureMessage AI</span>
                    </div>
                    <p>Advanced AI-powered spam detection and cybersecurity solutions.</p>
                </div>
                
                <div class="footer-section">
                    <h4>Analytics</h4>
                    <ul>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="#">Reports</a></li>
                        <li><a href="#">API Access</a></li>
                        <li><a href="#">Data Export</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Security</h4>
                    <ul>
                        <li><a href="index.html">Spam Detection</a></li>
                        <li><a href="#">Threat Intelligence</a></li>
                        <li><a href="#">Email Security</a></li>
                        <li><a href="#">URL Scanner</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="contact.html">Contact Us</a></li>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">API Guide</a></li>
                        <li><a href="#">Status Page</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 SecureMessage AI. All rights reserved.</p>
                <p>Protecting your digital communications with advanced AI technology.</p>
            </div>
        </div>
    </footer>

    <script src="js/globalErrorFix.js"></script>
    <script src="js/missingFilesFix.js"></script>
    <script src="js/pageValidator.js"></script>
    <script src="js/themeManager.js"></script>
    <script src="js/apiService.js"></script>
    <script src="js/authManager.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/errorFix.js"></script>
    <script src="js/profileClickHandler.js"></script>
    <script src="js/userInterface.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/navigation.js"></script>
    
    <script>
        // Protect dashboard page - require authentication
        document.addEventListener('DOMContentLoaded', async function() {
            // Wait for authManager to initialize
            if (window.authManager) {
                // The init method is now async, so we need to wait for it
                await window.authManager.init();
                
                // Check if user is authenticated
                if (!window.authManager.isLoggedIn()) {
                    // Redirect to login page
                    window.location.href = 'login.html';
                    return;
                }
                
                // Update UI with user info
                const currentUser = window.authManager.getCurrentUser();
                if (currentUser) {
                    document.getElementById('welcome-message').textContent = `Welcome back, ${currentUser.name}!`;
                    document.getElementById('user-name-display').textContent = currentUser.name;
                    
                    // Format dates
                    const joinDate = new Date(currentUser.joinDate);
                    document.getElementById('member-since').textContent = `Member since ${joinDate.toLocaleDateString()}`;
                    
                    const lastLogin = new Date(currentUser.lastLogin);
                    document.getElementById('last-login').textContent = `Last login: ${lastLogin.toLocaleDateString()}`;
                }
            } else {
                // If authManager is not available, redirect to login
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
